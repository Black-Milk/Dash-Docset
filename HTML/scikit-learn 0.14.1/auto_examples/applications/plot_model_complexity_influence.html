
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
  
    <title>Model Complexity Influence &mdash; scikit-learn 0.14.1 documentation</title>
  <!-- htmltitle is before nature.css - we use this hack to load bootstrap first -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="../../_static/css/bootstrap.min.css" media="screen" />
  <link rel="stylesheet" href="../../_static/css/bootstrap-responsive.css"/>

    
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.14.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/js/copybutton.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="top" title="scikit-learn 0.14.1 documentation" href="../../index.html" />
    <link rel="up" title="Examples" href="../index.html" />
    <link rel="next" title="Species distribution modeling" href="plot_species_distribution_modeling.html" />
    <link rel="prev" title="Faces recognition example using eigenfaces and SVMs" href="face_recognition.html" />
  
   
       <script type="text/javascript" src="../../_static/sidebar.js"></script>
   
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="../../_static/js/bootstrap.min.js" type="text/javascript"></script>
  <link rel="canonical" href="http://scikit-learn.org/stable/auto_examples/applications/plot_model_complexity_influence.html" />

  <script type="text/javascript">
    $("div.buttonNext, div.buttonPrevious").hover(
       function () {
           $(this).css('background-color', '#FF9C34');
       },
       function () {
           $(this).css('background-color', '#A7D6E2');
       }
    );
    var bodywrapper = $('.bodywrapper');
    var sidebarbutton = $('#sidebarbutton');
    sidebarbutton.css({'height': '900px'});
  </script>

  </head>
  <body>

<div class="header-wrapper">
    <div class="header">
        <p class="logo"><a href="../../index.html">
            <img src="../../_static/scikit-learn-logo-small.png" alt="Logo"/>
        </a>
        </p><div class="navbar">
            <ul>
                <li><a href="../../../stable/index.html">Home</a></li>
                <li><a href="../../../stable/install.html">Installation</a></li>
                <li class="btn-li"><div class="btn-group">
		      <a href="../../documentation.html">Documentation</a>
		      <a class="btn dropdown-toggle" data-toggle="dropdown">
			     <span class="caret"></span>
		      </a>
		      <ul class="dropdown-menu">
			<li class="link-title">Scikit-learn 0.14 (stable)</li>
			<li><a href="../../tutorial/index.html">Tutorials</a></li>
			<li><a href="../../user_guide.html">User guide</a></li>
			<li><a href="../../modules/classes.html">API</a></li>
			<li class="divider"></li>
		        <li><a href="http://scikit-learn.org/dev/documentation.html">Development</a></li>
		        <li><a href="http://scikit-learn.org/0.13/">Scikit-learn 0.13</a></li>
		        <li><a href="http://scikit-learn.org/0.12/">Scikit-learn 0.12</a></li>
		        <li><a href="http://scikit-learn.org/0.11/">Scikit-learn 0.11</a></li>
		        <li><a href="../../documentation.html">More versions...</a></li>
		      </ul>
		    </div>
		</li>
            <li><a href="../index.html">Examples</a></li>
            </ul>

            <div class="search_form">
                <div id="cse" style="width: 100%;"></div>
            </div>
        </div> <!-- end navbar --></div>
</div>


<!-- Github "fork me" ribbon -->
<a href="https://github.com/scikit-learn/scikit-learn">
  <img class="fork-me"
       style="position: absolute; top: 0; right: 0; border: 0;"
       src="../../_static/img/forkme.png"
       alt="Fork me on GitHub" />
</a>

<div class="content-wrapper">
    <div class="sphinxsidebar">
    <div class="sphinxsidebarwrapper">
        <div class="rel">
    

  <!-- rellinks[1:] is an ugly hack to avoid link to module
  index -->
        <div class="rellink">
        <a href="face_recognition.html"
        accesskey="P">Previous
        <br/>
        <span class="smallrellink">
        Faces recognitio...
        </span>
            <span class="hiddenrellink">
            Faces recognition example using eigenfaces and SVMs
            </span>
        </a>
        </div>
            <div class="spacer">
            &nbsp;
            </div>
        <div class="rellink">
        <a href="plot_species_distribution_modeling.html"
        accesskey="N">Next
        <br/>
        <span class="smallrellink">
        Species distribu...
        </span>
            <span class="hiddenrellink">
            Species distribution modeling
            </span>
        </a>
        </div>
            <div class="spacer">
            &nbsp;
            </div>
        <div class="rellink">
        <a href="../../np-modindex.html"
        >Modules
        <br/>
        <span class="smallrellink">
        Python Module In...
        </span>
            <span class="hiddenrellink">
            Python Module Index
            </span>
        </a>
        </div>
            <div class="spacer">
            &nbsp;
            </div>
        <div class="rellink">
        <a href="../../py-modindex.html"
        >Modules
        <br/>
        <span class="smallrellink">
        Python Module In...
        </span>
            <span class="hiddenrellink">
            Python Module Index
            </span>
        </a>
        </div>

    <!-- Ad a link to the 'up' page -->
        <div class="spacer">
        &nbsp;
        </div>
        <div class="rellink">
        <a href="../index.html">
        Up
        <br/>
        <span class="smallrellink">
        Examples
        </span>
            <span class="hiddenrellink">
            Examples
            </span>
            
        </a>
        </div>
    </div>
    
      <p class="doc-version">This documentation is for scikit-learn <strong>version 0.14.1</strong> &mdash; <a href="http://scikit-learn.org/stable/support.html#documentation-resources">Other versions</a></p>
    <p class="citing">If you use the software, please consider <a href="../../about.html#citing-scikit-learn">citing scikit-learn</a>.</p>
    <ul>
<li><a class="reference internal" href="#">Model Complexity Influence</a></li>
</ul>

    </div>
</div>



      <div class="content">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="model-complexity-influence">
<span id="example-applications-plot-model-complexity-influence-py"></span><h1>Model Complexity Influence<a class="headerlink" href="#model-complexity-influence" title="Permalink to this headline">Â¶</a></h1>
<p>Demonstrate how model complexity influences both prediction accuracy and
computational performance.</p>
<p>The dataset is the Boston Housing dataset (resp. 20 Newsgroups) for
regression (resp. classification).</p>
<p>For each class of models we make the model complexity vary through the choice
of relevant model parameters and measure the influence on both computational
performance (latency) and predictive power (MSE or Hamming Loss).</p>
<ul class="horizontal">
<li><a class="first reference internal image-reference" href="../../_images/plot_model_complexity_influence_1.png"><img alt="../../_images/plot_model_complexity_influence_1.png" src="../../_images/plot_model_complexity_influence_1.png" style="width: 564.0px; height: 282.0px;" /></a>
</li>
<li><a class="first reference internal image-reference" href="../../_images/plot_model_complexity_influence_2.png"><img alt="../../_images/plot_model_complexity_influence_2.png" src="../../_images/plot_model_complexity_influence_2.png" style="width: 564.0px; height: 282.0px;" /></a>
</li>
<li><a class="first reference internal image-reference" href="../../_images/plot_model_complexity_influence_3.png"><img alt="../../_images/plot_model_complexity_influence_3.png" src="../../_images/plot_model_complexity_influence_3.png" style="width: 564.0px; height: 282.0px;" /></a>
</li>
</ul>
<p><strong>Script output</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre>Benchmarking SGDClassifier(alpha=0.001, class_weight=None, epsilon=0.1, eta0=0.0,
       fit_intercept=True, l1_ratio=0.25, learning_rate=optimal,
       loss=modified_huber, n_iter=5, n_jobs=1, penalty=elasticnet,
       power_t=0.5, random_state=None, rho=None, shuffle=False, verbose=0,
       warm_start=False)
Complexity: 890 | Hamming Loss (Misclassification Ratio): 0.3194 | Pred. Time: 0.013436s

Benchmarking SGDClassifier(alpha=0.001, class_weight=None, epsilon=0.1, eta0=0.0,
       fit_intercept=True, l1_ratio=0.5, learning_rate=optimal,
       loss=modified_huber, n_iter=5, n_jobs=1, penalty=elasticnet,
       power_t=0.5, random_state=None, rho=None, shuffle=False, verbose=0,
       warm_start=False)
Complexity: 1668 | Hamming Loss (Misclassification Ratio): 0.2939 | Pred. Time: 0.016535s

Benchmarking SGDClassifier(alpha=0.001, class_weight=None, epsilon=0.1, eta0=0.0,
       fit_intercept=True, l1_ratio=0.75, learning_rate=optimal,
       loss=modified_huber, n_iter=5, n_jobs=1, penalty=elasticnet,
       power_t=0.5, random_state=None, rho=None, shuffle=False, verbose=0,
       warm_start=False)
Complexity: 4516 | Hamming Loss (Misclassification Ratio): 0.2562 | Pred. Time: 0.022368s

Benchmarking SGDClassifier(alpha=0.001, class_weight=None, epsilon=0.1, eta0=0.0,
       fit_intercept=True, l1_ratio=0.9, learning_rate=optimal,
       loss=modified_huber, n_iter=5, n_jobs=1, penalty=elasticnet,
       power_t=0.5, random_state=None, rho=None, shuffle=False, verbose=0,
       warm_start=False)
Complexity: 14541 | Hamming Loss (Misclassification Ratio): 0.2143 | Pred. Time: 0.028676s

Benchmarking NuSVR(C=1000.0, cache_size=200, coef0=0.0, degree=3, gamma=3.0517578125e-05,
   kernel=rbf, max_iter=-1, nu=0.1, probability=False, random_state=None,
   shrinking=True, tol=0.001, verbose=False)
Complexity: 69 | MSE: 31.8133 | Pred. Time: 0.000250s

Benchmarking NuSVR(C=1000.0, cache_size=200, coef0=0.0, degree=3, gamma=3.0517578125e-05,
   kernel=rbf, max_iter=-1, nu=0.25, probability=False, random_state=None,
   shrinking=True, tol=0.001, verbose=False)
Complexity: 136 | MSE: 25.6140 | Pred. Time: 0.000448s

Benchmarking NuSVR(C=1000.0, cache_size=200, coef0=0.0, degree=3, gamma=3.0517578125e-05,
   kernel=rbf, max_iter=-1, nu=0.5, probability=False, random_state=None,
   shrinking=True, tol=0.001, verbose=False)
Complexity: 243 | MSE: 22.3315 | Pred. Time: 0.000723s

Benchmarking NuSVR(C=1000.0, cache_size=200, coef0=0.0, degree=3, gamma=3.0517578125e-05,
   kernel=rbf, max_iter=-1, nu=0.75, probability=False, random_state=None,
   shrinking=True, tol=0.001, verbose=False)
Complexity: 350 | MSE: 21.3679 | Pred. Time: 0.001038s

Benchmarking NuSVR(C=1000.0, cache_size=200, coef0=0.0, degree=3, gamma=3.0517578125e-05,
   kernel=rbf, max_iter=-1, nu=0.9, probability=False, random_state=None,
   shrinking=True, tol=0.001, verbose=False)
Complexity: 404 | MSE: 21.0915 | Pred. Time: 0.001165s

Benchmarking GradientBoostingRegressor(alpha=0.9, init=None, learning_rate=0.1, loss=ls,
             max_depth=3, max_features=None, min_samples_leaf=1,
             min_samples_split=2, n_estimators=10, random_state=None,
             subsample=1.0, verbose=0)
Complexity: 10 | MSE: 28.5552 | Pred. Time: 0.000187s

Benchmarking GradientBoostingRegressor(alpha=0.9, init=None, learning_rate=0.1, loss=ls,
             max_depth=3, max_features=None, min_samples_leaf=1,
             min_samples_split=2, n_estimators=50, random_state=None,
             subsample=1.0, verbose=0)
Complexity: 50 | MSE: 8.0765 | Pred. Time: 0.000113s

Benchmarking GradientBoostingRegressor(alpha=0.9, init=None, learning_rate=0.1, loss=ls,
             max_depth=3, max_features=None, min_samples_leaf=1,
             min_samples_split=2, n_estimators=100, random_state=None,
             subsample=1.0, verbose=0)
Complexity: 100 | MSE: 6.9914 | Pred. Time: 0.000185s

Benchmarking GradientBoostingRegressor(alpha=0.9, init=None, learning_rate=0.1, loss=ls,
             max_depth=3, max_features=None, min_samples_leaf=1,
             min_samples_split=2, n_estimators=200, random_state=None,
             subsample=1.0, verbose=0)
Complexity: 200 | MSE: 5.9493 | Pred. Time: 0.000349s

Benchmarking GradientBoostingRegressor(alpha=0.9, init=None, learning_rate=0.1, loss=ls,
             max_depth=3, max_features=None, min_samples_leaf=1,
             min_samples_split=2, n_estimators=500, random_state=None,
             subsample=1.0, verbose=0)
Complexity: 500 | MSE: 6.2509 | Pred. Time: 0.000790s
</pre></div>
</div>
<p><strong>Python source code:</strong> <a class="reference download internal" href="../../_downloads/plot_model_complexity_influence.py"><tt class="xref download docutils literal"><span class="pre">plot_model_complexity_influence.py</span></tt></a></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span><span class="p">(</span><span class="n">__doc__</span><span class="p">)</span>

<span class="c"># Author: Eustache Diemert &lt;eustache@diemert.fr&gt;</span>
<span class="c"># License: BSD 3 clause</span>

<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pylab</span> <span class="kn">as</span> <span class="nn">pl</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1.parasite_axes</span> <span class="kn">import</span> <span class="n">host_subplot</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axisartist.axislines</span> <span class="kn">import</span> <span class="n">Axes</span>
<span class="kn">from</span> <span class="nn">scipy.sparse.csr</span> <span class="kn">import</span> <a href="http://docs.scipy.org/doc/scipy-0.11.0/reference/generated/scipy.sparse.csr_matrix.getH.html#scipy.sparse.csr_matrix"><span class="n">csr_matrix</span></a>

<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">datasets</span>
<span class="kn">from</span> <span class="nn">sklearn.utils</span> <span class="kn">import</span> <a href="../../modules/generated/sklearn.utils.shuffle.html#sklearn.utils.shuffle"><span class="n">shuffle</span></a>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="kn">from</span> <span class="nn">sklearn.svm.classes</span> <span class="kn">import</span> <span class="n">NuSVR</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble.gradient_boosting</span> <span class="kn">import</span> <span class="n">GradientBoostingRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model.stochastic_gradient</span> <span class="kn">import</span> <span class="n">SGDClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics.metrics</span> <span class="kn">import</span> <span class="n">hamming_loss</span>

<span class="c">###############################################################################</span>
<span class="c"># Routines</span>


<span class="c"># initialize random generator</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">generate_data</span><span class="p">(</span><span class="n">case</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate regression/classification data.&quot;&quot;&quot;</span>
    <span class="n">bunch</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">case</span> <span class="o">==</span> <span class="s">&#39;regression&#39;</span><span class="p">:</span>
        <span class="n">bunch</span> <span class="o">=</span> <a href="../../modules/generated/sklearn.datasets.load_boston.html#sklearn.datasets.load_boston"><span class="n">datasets</span><span class="o">.</span><span class="n">load_boston</span></a><span class="p">()</span>
    <span class="k">elif</span> <span class="n">case</span> <span class="o">==</span> <span class="s">&#39;classification&#39;</span><span class="p">:</span>
        <span class="n">bunch</span> <span class="o">=</span> <a href="../../modules/generated/sklearn.datasets.fetch_20newsgroups_vectorized.html#sklearn.datasets.fetch_20newsgroups_vectorized"><span class="n">datasets</span><span class="o">.</span><span class="n">fetch_20newsgroups_vectorized</span></a><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s">&#39;all&#39;</span><span class="p">)</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <a href="../../modules/generated/sklearn.utils.shuffle.html#sklearn.utils.shuffle"><span class="n">shuffle</span></a><span class="p">(</span><span class="n">bunch</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">bunch</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">)</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="n">offset</span><span class="p">],</span> <span class="n">y</span><span class="p">[:</span><span class="n">offset</span><span class="p">]</span>
    <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">offset</span><span class="p">:],</span> <span class="n">y</span><span class="p">[</span><span class="n">offset</span><span class="p">:]</span>
    <span class="k">if</span> <span class="n">sparse</span><span class="p">:</span>
        <span class="n">X_train</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/scipy-0.11.0/reference/generated/scipy.sparse.csr_matrix.getH.html#scipy.sparse.csr_matrix"><span class="n">csr_matrix</span></a><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
        <span class="n">X_test</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/scipy-0.11.0/reference/generated/scipy.sparse.csr_matrix.getH.html#scipy.sparse.csr_matrix"><span class="n">csr_matrix</span></a><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">X_train</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.6.0/reference/generated/numpy.array.html#numpy.array"><span class="n">np</span><span class="o">.</span><span class="n">array</span></a><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
        <span class="n">X_test</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.6.0/reference/generated/numpy.array.html#numpy.array"><span class="n">np</span><span class="o">.</span><span class="n">array</span></a><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">y_test</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.6.0/reference/generated/numpy.array.html#numpy.array"><span class="n">np</span><span class="o">.</span><span class="n">array</span></a><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>
    <span class="n">y_train</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.6.0/reference/generated/numpy.array.html#numpy.array"><span class="n">np</span><span class="o">.</span><span class="n">array</span></a><span class="p">(</span><span class="n">y_train</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;X_train&#39;</span><span class="p">:</span> <span class="n">X_train</span><span class="p">,</span> <span class="s">&#39;X_test&#39;</span><span class="p">:</span> <span class="n">X_test</span><span class="p">,</span> <span class="s">&#39;y_train&#39;</span><span class="p">:</span> <span class="n">y_train</span><span class="p">,</span>
            <span class="s">&#39;y_test&#39;</span><span class="p">:</span> <span class="n">y_test</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">data</span>


<span class="k">def</span> <span class="nf">benchmark_influence</span><span class="p">(</span><span class="n">conf</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Benchmark influence of :changing_param: on both MSE and latency.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">prediction_times</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">prediction_powers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">complexities</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">param_value</span> <span class="ow">in</span> <span class="n">conf</span><span class="p">[</span><span class="s">&#39;changing_param_values&#39;</span><span class="p">]:</span>
        <span class="n">conf</span><span class="p">[</span><span class="s">&#39;tuned_params&#39;</span><span class="p">][</span><span class="n">conf</span><span class="p">[</span><span class="s">&#39;changing_param&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">param_value</span>
        <span class="n">estimator</span> <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s">&#39;estimator&#39;</span><span class="p">](</span><span class="o">**</span><span class="n">conf</span><span class="p">[</span><span class="s">&#39;tuned_params&#39;</span><span class="p">])</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Benchmarking </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">estimator</span><span class="p">)</span>
        <span class="n">estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">conf</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;X_train&#39;</span><span class="p">],</span> <span class="n">conf</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;y_train&#39;</span><span class="p">])</span>
        <span class="n">conf</span><span class="p">[</span><span class="s">&#39;postfit_hook&#39;</span><span class="p">](</span><span class="n">estimator</span><span class="p">)</span>
        <span class="n">complexity</span> <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s">&#39;complexity_computer&#39;</span><span class="p">](</span><span class="n">estimator</span><span class="p">)</span>
        <span class="n">complexities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">complexity</span><span class="p">)</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">conf</span><span class="p">[</span><span class="s">&#39;n_samples&#39;</span><span class="p">]):</span>
            <span class="n">y_pred</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">conf</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;X_test&#39;</span><span class="p">])</span>
        <span class="n">elapsed_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">conf</span><span class="p">[</span><span class="s">&#39;n_samples&#39;</span><span class="p">])</span>
        <span class="n">prediction_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elapsed_time</span><span class="p">)</span>
        <span class="n">pred_score</span> <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s">&#39;prediction_performance_computer&#39;</span><span class="p">](</span>
            <span class="n">conf</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;y_test&#39;</span><span class="p">],</span> <span class="n">y_pred</span><span class="p">)</span>
        <span class="n">prediction_powers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred_score</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Complexity: </span><span class="si">%d</span><span class="s"> | </span><span class="si">%s</span><span class="s">: </span><span class="si">%.4f</span><span class="s"> | Pred. Time: </span><span class="si">%f</span><span class="s">s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">complexity</span><span class="p">,</span> <span class="n">conf</span><span class="p">[</span><span class="s">&#39;prediction_performance_label&#39;</span><span class="p">],</span> <span class="n">pred_score</span><span class="p">,</span>
            <span class="n">elapsed_time</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">prediction_powers</span><span class="p">,</span> <span class="n">prediction_times</span><span class="p">,</span> <span class="n">complexities</span>


<span class="k">def</span> <span class="nf">plot_influence</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">mse_values</span><span class="p">,</span> <span class="n">prediction_times</span><span class="p">,</span> <span class="n">complexities</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot influence of model complexity on both accuracy and latency.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <a href="http://matplotlib.org/api/figure_api.html#matplotlib.figure"><span class="n">pl</span><span class="o">.</span><span class="n">figure</span></a><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">host</span> <span class="o">=</span> <span class="n">host_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">axes_class</span><span class="o">=</span><span class="n">Axes</span><span class="p">)</span>
    <a href="http://matplotlib.org/api/pyplot_api.html#matplotlib.pyplot.subplots_adjust"><span class="n">pl</span><span class="o">.</span><span class="n">subplots_adjust</span></a><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
    <span class="n">par1</span> <span class="o">=</span> <span class="n">host</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
    <span class="n">host</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Model Complexity (</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="n">conf</span><span class="p">[</span><span class="s">&#39;complexity_label&#39;</span><span class="p">])</span>
    <span class="n">y1_label</span> <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s">&#39;prediction_performance_label&#39;</span><span class="p">]</span>
    <span class="n">y2_label</span> <span class="o">=</span> <span class="s">&quot;Time (s)&quot;</span>
    <span class="n">host</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">y1_label</span><span class="p">)</span>
    <span class="n">par1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">y2_label</span><span class="p">)</span>
    <span class="n">p1</span><span class="p">,</span> <span class="o">=</span> <span class="n">host</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">complexities</span><span class="p">,</span> <span class="n">mse_values</span><span class="p">,</span> <span class="s">&#39;b-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;prediction error&quot;</span><span class="p">)</span>
    <span class="n">p2</span><span class="p">,</span> <span class="o">=</span> <span class="n">par1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">complexities</span><span class="p">,</span> <span class="n">prediction_times</span><span class="p">,</span> <span class="s">&#39;r-&#39;</span><span class="p">,</span>
                    <span class="n">label</span><span class="o">=</span><span class="s">&quot;latency&quot;</span><span class="p">)</span>
    <span class="n">host</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">&#39;upper right&#39;</span><span class="p">)</span>
    <span class="n">host</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s">&quot;left&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">get_color</span><span class="p">())</span>
    <span class="n">par1</span><span class="o">.</span><span class="n">axis</span><span class="p">[</span><span class="s">&quot;right&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">p2</span><span class="o">.</span><span class="n">get_color</span><span class="p">())</span>
    <a href="http://matplotlib.org/api/pyplot_api.html#matplotlib.pyplot.title"><span class="n">pl</span><span class="o">.</span><span class="n">title</span></a><span class="p">(</span><span class="s">&#39;Influence of Model Complexity - </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">conf</span><span class="p">[</span><span class="s">&#39;estimator&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
    <a href="http://matplotlib.org/api/pyplot_api.html#matplotlib.pyplot.show"><span class="n">pl</span><span class="o">.</span><span class="n">show</span></a><span class="p">()</span>


<span class="k">def</span> <span class="nf">_count_nonzero_coefficients</span><span class="p">(</span><span class="n">estimator</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">coef_</span><span class="o">.</span><span class="n">todense</span><span class="p">()</span>
    <span class="k">return</span> <a href="http://docs.scipy.org/doc/numpy-1.6.0/reference/generated/numpy.count_nonzero.html#numpy.count_nonzero"><span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span></a><span class="p">(</span><span class="n">a</span><span class="p">)</span>

<span class="c">###############################################################################</span>
<span class="c"># main code</span>
<span class="n">regression_data</span> <span class="o">=</span> <span class="n">generate_data</span><span class="p">(</span><span class="s">&#39;regression&#39;</span><span class="p">)</span>
<span class="n">classification_data</span> <span class="o">=</span> <span class="n">generate_data</span><span class="p">(</span><span class="s">&#39;classification&#39;</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">configurations</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s">&#39;estimator&#39;</span><span class="p">:</span> <span class="n">SGDClassifier</span><span class="p">,</span>
     <span class="s">&#39;tuned_params&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;penalty&#39;</span><span class="p">:</span> <span class="s">&#39;elasticnet&#39;</span><span class="p">,</span> <span class="s">&#39;alpha&#39;</span><span class="p">:</span> <span class="mf">0.001</span><span class="p">,</span> <span class="s">&#39;loss&#39;</span><span class="p">:</span>
                      <span class="s">&#39;modified_huber&#39;</span><span class="p">,</span> <span class="s">&#39;fit_intercept&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">},</span>
     <span class="s">&#39;changing_param&#39;</span><span class="p">:</span> <span class="s">&#39;l1_ratio&#39;</span><span class="p">,</span>
     <span class="s">&#39;changing_param_values&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">],</span>
     <span class="s">&#39;complexity_label&#39;</span><span class="p">:</span> <span class="s">&#39;non_zero coefficients&#39;</span><span class="p">,</span>
     <span class="s">&#39;complexity_computer&#39;</span><span class="p">:</span> <span class="n">_count_nonzero_coefficients</span><span class="p">,</span>
     <span class="s">&#39;prediction_performance_computer&#39;</span><span class="p">:</span> <span class="n">hamming_loss</span><span class="p">,</span>
     <span class="s">&#39;prediction_performance_label&#39;</span><span class="p">:</span> <span class="s">&#39;Hamming Loss (Misclassification Ratio)&#39;</span><span class="p">,</span>
     <span class="s">&#39;postfit_hook&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">sparsify</span><span class="p">(),</span>
     <span class="s">&#39;data&#39;</span><span class="p">:</span> <span class="n">classification_data</span><span class="p">,</span>
     <span class="s">&#39;n_samples&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">},</span>
    <span class="p">{</span><span class="s">&#39;estimator&#39;</span><span class="p">:</span> <span class="n">NuSVR</span><span class="p">,</span>
     <span class="s">&#39;tuned_params&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;C&#39;</span><span class="p">:</span> <span class="mf">1e3</span><span class="p">,</span> <span class="s">&#39;gamma&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="o">**-</span><span class="mi">15</span><span class="p">},</span>
     <span class="s">&#39;changing_param&#39;</span><span class="p">:</span> <span class="s">&#39;nu&#39;</span><span class="p">,</span>
     <span class="s">&#39;changing_param_values&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">],</span>
     <span class="s">&#39;complexity_label&#39;</span><span class="p">:</span> <span class="s">&#39;n_support_vectors&#39;</span><span class="p">,</span>
     <span class="s">&#39;complexity_computer&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">support_vectors_</span><span class="p">),</span>
     <span class="s">&#39;data&#39;</span><span class="p">:</span> <span class="n">regression_data</span><span class="p">,</span>
     <span class="s">&#39;postfit_hook&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span>
     <span class="s">&#39;prediction_performance_computer&#39;</span><span class="p">:</span> <span class="n">mean_squared_error</span><span class="p">,</span>
     <span class="s">&#39;prediction_performance_label&#39;</span><span class="p">:</span> <span class="s">&#39;MSE&#39;</span><span class="p">,</span>
     <span class="s">&#39;n_samples&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">},</span>
    <span class="p">{</span><span class="s">&#39;estimator&#39;</span><span class="p">:</span> <span class="n">GradientBoostingRegressor</span><span class="p">,</span>
     <span class="s">&#39;tuned_params&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;loss&#39;</span><span class="p">:</span> <span class="s">&#39;ls&#39;</span><span class="p">},</span>
     <span class="s">&#39;changing_param&#39;</span><span class="p">:</span> <span class="s">&#39;n_estimators&#39;</span><span class="p">,</span>
     <span class="s">&#39;changing_param_values&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">500</span><span class="p">],</span>
     <span class="s">&#39;complexity_label&#39;</span><span class="p">:</span> <span class="s">&#39;n_trees&#39;</span><span class="p">,</span>
     <span class="s">&#39;complexity_computer&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">n_estimators</span><span class="p">,</span>
     <span class="s">&#39;data&#39;</span><span class="p">:</span> <span class="n">regression_data</span><span class="p">,</span>
     <span class="s">&#39;postfit_hook&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span>
     <span class="s">&#39;prediction_performance_computer&#39;</span><span class="p">:</span> <span class="n">mean_squared_error</span><span class="p">,</span>
     <span class="s">&#39;prediction_performance_label&#39;</span><span class="p">:</span> <span class="s">&#39;MSE&#39;</span><span class="p">,</span>
     <span class="s">&#39;n_samples&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">},</span>
<span class="p">]</span>
<span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="n">configurations</span><span class="p">:</span>
    <span class="n">prediction_performances</span><span class="p">,</span> <span class="n">prediction_times</span><span class="p">,</span> <span class="n">complexities</span> <span class="o">=</span> \
        <span class="n">benchmark_influence</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
    <span class="n">plot_influence</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">prediction_performances</span><span class="p">,</span> <span class="n">prediction_times</span><span class="p">,</span>
                   <span class="n">complexities</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Total running time of the example:</strong>  84.69 seconds
( 1 minutes  24.69 seconds)</p>
</div>


          </div>
        </div>
      </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer">
        &copy; 2010 - 2014, scikit-learn developers (BSD License).
      <a href="../../_sources/auto_examples/applications/plot_model_complexity_influence.txt" rel="nofollow">Show this page source</a>
    </div>
     <div class="rel">
    
    <div class="buttonPrevious">
      <a href="face_recognition.html">Previous
      </a>
    </div>
    <div class="buttonNext">
      <a href="plot_species_distribution_modeling.html">Next
      </a>
    </div>
    <div class="buttonPrevious">
      <a href="../../np-modindex.html">Previous
      </a>
    </div>
    <div class="buttonNext">
      <a href="../../py-modindex.html">Next
      </a>
    </div>
    
     </div>

    
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-22606712-2']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    

    <script src="http://www.google.com/jsapi" type="text/javascript"></script>
    <script type="text/javascript"> google.load('search', '1',
        {language : 'en'}); google.setOnLoadCallback(function() {
            var customSearchControl = new
            google.search.CustomSearchControl('016639176250731907682:tjtqbvtvij0');
            customSearchControl.setResultSetSize(google.search.Search.FILTERED_CSE_RESULTSET);
            var options = new google.search.DrawOptions();
            options.setAutoComplete(true);
            customSearchControl.draw('cse', options); }, true);
    </script>
  </body>
</html>