

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Reshaping and Pivot Tables &mdash; pandas 0.11.1.dev-36c1263 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.11.1.dev-36c1263',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="pandas 0.11.1.dev-36c1263 documentation" href="index.html" />
    <link rel="next" title="Time Series / Date functionality" href="timeseries.html" />
    <link rel="prev" title="Merge, join, and concatenate" href="merging.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="timeseries.html" title="Time Series / Date functionality"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="merging.html" title="Merge, join, and concatenate"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">pandas 0.11.1.dev-36c1263 documentation</a> &raquo;</li> 
      </ul>
    </div>
<div class="content-wrapper">
    <div class="content">
        <div class="document">
            <div class="sphinxsidebar">
                <h3>Table Of Contents</h3>
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="whatsnew.html">What&#8217;s New</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions (FAQ)</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Package overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="10min.html">10 Minutes to Pandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="cookbook.html">Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="dsintro.html">Intro to Data Structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="basics.html">Essential Basic Functionality</a></li>
<li class="toctree-l1"><a class="reference internal" href="indexing.html">Indexing and Selecting Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="computation.html">Computational tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="missing_data.html">Working with missing data</a></li>
<li class="toctree-l1"><a class="reference internal" href="groupby.html">Group By: split-apply-combine</a></li>
<li class="toctree-l1"><a class="reference internal" href="merging.html">Merge, join, and concatenate</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Reshaping and Pivot Tables</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#reshaping-by-pivoting-dataframe-objects">Reshaping by pivoting DataFrame objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="#reshaping-by-stacking-and-unstacking">Reshaping by stacking and unstacking</a></li>
<li class="toctree-l2"><a class="reference internal" href="#reshaping-by-melt">Reshaping by Melt</a></li>
<li class="toctree-l2"><a class="reference internal" href="#combining-with-stats-and-groupby">Combining with stats and GroupBy</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pivot-tables-and-cross-tabulations">Pivot tables and cross-tabulations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#cross-tabulations">Cross tabulations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-margins-partial-aggregates">Adding margins (partial aggregates)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#tiling">Tiling</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="timeseries.html">Time Series / Date functionality</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualization.html">Plotting with matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="rplot.html">Trellis plotting interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="io.html">IO Tools (Text, CSV, HDF5, ...)</a></li>
<li class="toctree-l1"><a class="reference internal" href="sparse.html">Sparse data structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="gotchas.html">Caveats and Gotchas</a></li>
<li class="toctree-l1"><a class="reference internal" href="r_interface.html">rpy2 / R interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="related.html">Related Python libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="comparison_with_r.html">Comparison with R / R libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="release.html">Release Notes</a></li>
</ul>

                <h3 style="margin-top: 1.5em;">Search</h3>

                <form class="search" action="search.html" method="get">
                    <input type="text" name="q" size="18"/>
                    <input type="submit" value="Go"/>
                    <input type="hidden" name="check_keywords" value="yes"/>
                    <input type="hidden" name="area" value="default"/>
                </form>
                <p class="searchtip" style="font-size: 90%">
                    Enter search terms or a module, class or function name.
                </p>

                <p>

                <p>
                    <script type="text/javascript"
                            src="http://www.ohloh.net/p/482908/widgets/project_partner_badge.js"></script>
                </p>
            </div>
             
            <div class="documentwrapper">
                <div class="bodywrapper">
                    <div class="body">
                        
  <div class="section" id="reshaping-and-pivot-tables">
<span id="reshaping"></span><h1>Reshaping and Pivot Tables<a class="headerlink" href="#reshaping-and-pivot-tables" title="Permalink to this headline">¶</a></h1>
<div class="section" id="reshaping-by-pivoting-dataframe-objects">
<h2>Reshaping by pivoting DataFrame objects<a class="headerlink" href="#reshaping-by-pivoting-dataframe-objects" title="Permalink to this headline">¶</a></h2>
<p>Data is often stored in CSV files or databases in so-called &#8220;stacked&#8221; or
&#8220;record&#8221; format:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1545]: </span><span class="n">df</span>

<span class="go">                  date variable     value</span>
<span class="go">0  2000-01-03 00:00:00        A  0.469112</span>
<span class="go">1  2000-01-04 00:00:00        A -0.282863</span>
<span class="go">2  2000-01-05 00:00:00        A -1.509059</span>
<span class="go">3  2000-01-03 00:00:00        B -1.135632</span>
<span class="go">4  2000-01-04 00:00:00        B  1.212112</span>
<span class="go">5  2000-01-05 00:00:00        B -0.173215</span>
<span class="go">6  2000-01-03 00:00:00        C  0.119209</span>
<span class="go">7  2000-01-04 00:00:00        C -1.044236</span>
<span class="go">8  2000-01-05 00:00:00        C -0.861849</span>
<span class="go">9  2000-01-03 00:00:00        D -2.104569</span>
<span class="go">10 2000-01-04 00:00:00        D -0.494929</span>
<span class="go">11 2000-01-05 00:00:00        D  1.071804</span>
</pre></div>
</div>
<p>For the curious here is how the above DataFrame was created:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">pandas.util.testing</span> <span class="kn">as</span> <span class="nn">tm</span><span class="p">;</span> <span class="n">tm</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="mi">3</span>
<span class="k">def</span> <span class="nf">unpivot</span><span class="p">(</span><span class="n">frame</span><span class="p">):</span>
    <span class="n">N</span><span class="p">,</span> <span class="n">K</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;value&#39;</span> <span class="p">:</span> <span class="n">frame</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="s">&#39;F&#39;</span><span class="p">),</span>
            <span class="s">&#39;variable&#39;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">N</span><span class="p">),</span>
            <span class="s">&#39;date&#39;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="n">K</span><span class="p">)}</span>
    <span class="k">return</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;date&#39;</span><span class="p">,</span> <span class="s">&#39;variable&#39;</span><span class="p">,</span> <span class="s">&#39;value&#39;</span><span class="p">])</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">unpivot</span><span class="p">(</span><span class="n">tm</span><span class="o">.</span><span class="n">makeTimeDataFrame</span><span class="p">())</span>
</pre></div>
</div>
<p>To select out everything for variable <tt class="docutils literal"><span class="pre">A</span></tt> we could do:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1546]: </span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s">&#39;variable&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;A&#39;</span><span class="p">]</span>

<span class="go">                 date variable     value</span>
<span class="go">0 2000-01-03 00:00:00        A  0.469112</span>
<span class="go">1 2000-01-04 00:00:00        A -0.282863</span>
<span class="go">2 2000-01-05 00:00:00        A -1.509059</span>
</pre></div>
</div>
<p>But suppose we wish to do time series operations with the variables. A better
representation would be where the <tt class="docutils literal"><span class="pre">columns</span></tt> are the unique variables and an
<tt class="docutils literal"><span class="pre">index</span></tt> of dates identifies individual observations. To reshape the data into
this form, use the <tt class="docutils literal"><span class="pre">pivot</span></tt> function:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1547]: </span><span class="n">df</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s">&#39;date&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s">&#39;variable&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s">&#39;value&#39;</span><span class="p">)</span>

<span class="go">variable           A         B         C         D</span>
<span class="go">date                                              </span>
<span class="go">2000-01-03  0.469112 -1.135632  0.119209 -2.104569</span>
<span class="go">2000-01-04 -0.282863  1.212112 -1.044236 -0.494929</span>
<span class="go">2000-01-05 -1.509059 -0.173215 -0.861849  1.071804</span>
</pre></div>
</div>
<p>If the <tt class="docutils literal"><span class="pre">values</span></tt> argument is omitted, and the input DataFrame has more than
one column of values which are not used as column or index inputs to <tt class="docutils literal"><span class="pre">pivot</span></tt>,
then the resulting &#8220;pivoted&#8221; DataFrame will have <a class="reference internal" href="indexing.html#indexing-hierarchical"><em>hierarchical columns</em></a> whose topmost level indicates the respective value
column:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1548]: </span><span class="n">df</span><span class="p">[</span><span class="s">&#39;value2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">&#39;value&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>

<span class="gp">In [1549]: </span><span class="n">pivoted</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="s">&#39;date&#39;</span><span class="p">,</span> <span class="s">&#39;variable&#39;</span><span class="p">)</span>

<span class="gp">In [1550]: </span><span class="n">pivoted</span>

<span class="go">               value                                  value2            \</span>
<span class="go">variable           A         B         C         D         A         B   </span>
<span class="go">date                                                                     </span>
<span class="go">2000-01-03  0.469112 -1.135632  0.119209 -2.104569  0.938225 -2.271265   </span>
<span class="go">2000-01-04 -0.282863  1.212112 -1.044236 -0.494929 -0.565727  2.424224   </span>
<span class="go">2000-01-05 -1.509059 -0.173215 -0.861849  1.071804 -3.018117 -0.346429   </span>
<span class="go">                                </span>
<span class="go">variable           C         D  </span>
<span class="go">date                            </span>
<span class="go">2000-01-03  0.238417 -4.209138  </span>
<span class="go">2000-01-04 -2.088472 -0.989859  </span>
<span class="go">2000-01-05 -1.723698  2.143608  </span>
</pre></div>
</div>
<p>You of course can then select subsets from the pivoted DataFrame:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1551]: </span><span class="n">pivoted</span><span class="p">[</span><span class="s">&#39;value2&#39;</span><span class="p">]</span>

<span class="go">variable           A         B         C         D</span>
<span class="go">date                                              </span>
<span class="go">2000-01-03  0.938225 -2.271265  0.238417 -4.209138</span>
<span class="go">2000-01-04 -0.565727  2.424224 -2.088472 -0.989859</span>
<span class="go">2000-01-05 -3.018117 -0.346429 -1.723698  2.143608</span>
</pre></div>
</div>
<p>Note that this returns a view on the underlying data in the case where the data
are homogeneously-typed.</p>
</div>
<div class="section" id="reshaping-by-stacking-and-unstacking">
<span id="reshaping-stacking"></span><h2>Reshaping by stacking and unstacking<a class="headerlink" href="#reshaping-by-stacking-and-unstacking" title="Permalink to this headline">¶</a></h2>
<p>Closely related to the <tt class="docutils literal"><span class="pre">pivot</span></tt> function are the related <tt class="docutils literal"><span class="pre">stack</span></tt> and
<tt class="docutils literal"><span class="pre">unstack</span></tt> functions currently available on Series and DataFrame. These
functions are designed to work together with <tt class="docutils literal"><span class="pre">MultiIndex</span></tt> objects (see the
section on <a class="reference internal" href="indexing.html#indexing-hierarchical"><em>hierarchical indexing</em></a>). Here are
essentially what these functions do:</p>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">stack</span></tt>: &#8220;pivot&#8221; a level of the (possibly hierarchical) column labels,
returning a DataFrame with an index with a new inner-most level of row
labels.</li>
<li><tt class="docutils literal"><span class="pre">unstack</span></tt>: inverse operation from <tt class="docutils literal"><span class="pre">stack</span></tt>: &#8220;pivot&#8221; a level of the
(possibly hierarchical) row index to the column axis, producing a reshaped
DataFrame with a new inner-most level of column labels.</li>
</ul>
</div></blockquote>
<p>The clearest way to explain is by example. Let&#8217;s take a prior example data set
from the hierarchical indexing section:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1552]: </span><span class="n">tuples</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[[</span><span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="s">&#39;baz&#39;</span><span class="p">,</span> <span class="s">&#39;baz&#39;</span><span class="p">,</span>
<span class="gp">   ......:</span>                 <span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;qux&#39;</span><span class="p">,</span> <span class="s">&#39;qux&#39;</span><span class="p">],</span>
<span class="gp">   ......:</span>                <span class="p">[</span><span class="s">&#39;one&#39;</span><span class="p">,</span> <span class="s">&#39;two&#39;</span><span class="p">,</span> <span class="s">&#39;one&#39;</span><span class="p">,</span> <span class="s">&#39;two&#39;</span><span class="p">,</span>
<span class="gp">   ......:</span>                 <span class="s">&#39;one&#39;</span><span class="p">,</span> <span class="s">&#39;two&#39;</span><span class="p">,</span> <span class="s">&#39;one&#39;</span><span class="p">,</span> <span class="s">&#39;two&#39;</span><span class="p">]])</span>
<span class="gp">   ......:</span> 

<span class="gp">In [1553]: </span><span class="n">index</span> <span class="o">=</span> <span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">tuples</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;first&#39;</span><span class="p">,</span> <span class="s">&#39;second&#39;</span><span class="p">])</span>

<span class="gp">In [1554]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">randn</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;B&#39;</span><span class="p">])</span>

<span class="gp">In [1555]: </span><span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>

<span class="gp">In [1556]: </span><span class="n">df2</span>

<span class="go">                     A         B</span>
<span class="go">first second                    </span>
<span class="go">bar   one     0.721555 -0.706771</span>
<span class="go">      two    -1.039575  0.271860</span>
<span class="go">baz   one    -0.424972  0.567020</span>
<span class="go">      two     0.276232 -1.087401</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">stack</span></tt> function &#8220;compresses&#8221; a level in the DataFrame&#8217;s columns to
produce either:</p>
<blockquote>
<div><ul class="simple">
<li>A Series, in the case of a simple column Index</li>
<li>A DataFrame, in the case of a <tt class="docutils literal"><span class="pre">MultiIndex</span></tt> in the columns</li>
</ul>
</div></blockquote>
<p>If the columns have a <tt class="docutils literal"><span class="pre">MultiIndex</span></tt>, you can choose which level to stack. The
stacked level becomes the new lowest level in a <tt class="docutils literal"><span class="pre">MultiIndex</span></tt> on the columns:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1557]: </span><span class="n">stacked</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span>

<span class="gp">In [1558]: </span><span class="n">stacked</span>

<span class="go">first  second   </span>
<span class="go">bar    one     A    0.721555</span>
<span class="go">               B   -0.706771</span>
<span class="go">       two     A   -1.039575</span>
<span class="go">               B    0.271860</span>
<span class="go">baz    one     A   -0.424972</span>
<span class="go">               B    0.567020</span>
<span class="go">       two     A    0.276232</span>
<span class="go">               B   -1.087401</span>
<span class="go">dtype: float64</span>
</pre></div>
</div>
<p>With a &#8220;stacked&#8221; DataFrame or Series (having a <tt class="docutils literal"><span class="pre">MultiIndex</span></tt> as the
<tt class="docutils literal"><span class="pre">index</span></tt>), the inverse operation of <tt class="docutils literal"><span class="pre">stack</span></tt> is <tt class="docutils literal"><span class="pre">unstack</span></tt>, which by default
unstacks the <strong>last level</strong>:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1559]: </span><span class="n">stacked</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>

<span class="go">                     A         B</span>
<span class="go">first second                    </span>
<span class="go">bar   one     0.721555 -0.706771</span>
<span class="go">      two    -1.039575  0.271860</span>
<span class="go">baz   one    -0.424972  0.567020</span>
<span class="go">      two     0.276232 -1.087401</span>

<span class="gp">In [1560]: </span><span class="n">stacked</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="go">second        one       two</span>
<span class="go">first                      </span>
<span class="go">bar   A  0.721555 -1.039575</span>
<span class="go">      B -0.706771  0.271860</span>
<span class="go">baz   A -0.424972  0.276232</span>
<span class="go">      B  0.567020 -1.087401</span>

<span class="gp">In [1561]: </span><span class="n">stacked</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="go">first          bar       baz</span>
<span class="go">second                      </span>
<span class="go">one    A  0.721555 -0.424972</span>
<span class="go">       B -0.706771  0.567020</span>
<span class="go">two    A -1.039575  0.276232</span>
<span class="go">       B  0.271860 -1.087401</span>
</pre></div>
</div>
<p id="reshaping-unstack-by-name">If the indexes have names, you can use the level names instead of specifying
the level numbers:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1562]: </span><span class="n">stacked</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s">&#39;second&#39;</span><span class="p">)</span>

<span class="go">second        one       two</span>
<span class="go">first                      </span>
<span class="go">bar   A  0.721555 -1.039575</span>
<span class="go">      B -0.706771  0.271860</span>
<span class="go">baz   A -0.424972  0.276232</span>
<span class="go">      B  0.567020 -1.087401</span>
</pre></div>
</div>
<p>You may also stack or unstack more than one level at a time by passing a list
of levels, in which case the end result is as if each level in the list were
processed individually.</p>
<p>These functions are intelligent about handling missing data and do not expect
each subgroup within the hierarchical index to have the same set of labels.
They also can handle the index being unsorted (but you can make it sorted by
calling <tt class="docutils literal"><span class="pre">sortlevel</span></tt>, of course). Here is a more complex example:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1563]: </span><span class="n">columns</span> <span class="o">=</span> <span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">([(</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;cat&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;B&#39;</span><span class="p">,</span> <span class="s">&#39;dog&#39;</span><span class="p">),</span>
<span class="gp">   ......:</span>                                   <span class="p">(</span><span class="s">&#39;B&#39;</span><span class="p">,</span> <span class="s">&#39;cat&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;dog&#39;</span><span class="p">)],</span>
<span class="gp">   ......:</span>                                  <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;exp&#39;</span><span class="p">,</span> <span class="s">&#39;animal&#39;</span><span class="p">])</span>
<span class="gp">   ......:</span> 

<span class="gp">In [1564]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">randn</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>

<span class="gp">In [1565]: </span><span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">ix</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">]]</span>

<span class="gp">In [1566]: </span><span class="n">df2</span>

<span class="go">exp                  A         B                   A</span>
<span class="go">animal             cat       dog       cat       dog</span>
<span class="go">first second                                        </span>
<span class="go">bar   one    -0.370647 -1.157892 -1.344312  0.844885</span>
<span class="go">      two     1.075770 -0.109050  1.643563 -1.469388</span>
<span class="go">baz   one     0.357021 -0.674600 -1.776904 -0.968914</span>
<span class="go">foo   one    -0.013960 -0.362543 -0.006154 -0.923061</span>
<span class="go">      two     0.895717  0.805244 -1.206412  2.565646</span>
<span class="go">qux   two     0.410835  0.813850  0.132003 -0.827317</span>
</pre></div>
</div>
<p>As mentioned above, <tt class="docutils literal"><span class="pre">stack</span></tt> can be called with a <tt class="docutils literal"><span class="pre">level</span></tt> argument to select
which level in the columns to stack:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1567]: </span><span class="n">df2</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="s">&#39;exp&#39;</span><span class="p">)</span>

<span class="go">animal                 cat       dog</span>
<span class="go">first second exp                    </span>
<span class="go">bar   one    A   -0.370647  0.844885</span>
<span class="go">             B   -1.344312 -1.157892</span>
<span class="go">      two    A    1.075770 -1.469388</span>
<span class="go">             B    1.643563 -0.109050</span>
<span class="go">baz   one    A    0.357021 -0.968914</span>
<span class="go">             B   -1.776904 -0.674600</span>
<span class="go">foo   one    A   -0.013960 -0.923061</span>
<span class="go">             B   -0.006154 -0.362543</span>
<span class="go">      two    A    0.895717  2.565646</span>
<span class="go">             B   -1.206412  0.805244</span>
<span class="go">qux   two    A    0.410835 -0.827317</span>
<span class="go">             B    0.132003  0.813850</span>

<span class="gp">In [1568]: </span><span class="n">df2</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="s">&#39;animal&#39;</span><span class="p">)</span>

<span class="go">exp                         A         B</span>
<span class="go">first second animal                    </span>
<span class="go">bar   one    cat    -0.370647 -1.344312</span>
<span class="go">             dog     0.844885 -1.157892</span>
<span class="go">      two    cat     1.075770  1.643563</span>
<span class="go">             dog    -1.469388 -0.109050</span>
<span class="go">baz   one    cat     0.357021 -1.776904</span>
<span class="go">             dog    -0.968914 -0.674600</span>
<span class="go">foo   one    cat    -0.013960 -0.006154</span>
<span class="go">             dog    -0.923061 -0.362543</span>
<span class="go">      two    cat     0.895717 -1.206412</span>
<span class="go">             dog     2.565646  0.805244</span>
<span class="go">qux   two    cat     0.410835  0.132003</span>
<span class="go">             dog    -0.827317  0.813850</span>
</pre></div>
</div>
<p>Unstacking when the columns are a <tt class="docutils literal"><span class="pre">MultiIndex</span></tt> is also careful about doing
the right thing:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1569]: </span><span class="n">df</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="go">exp            A                   B                                     A  \</span>
<span class="go">animal       cat                 dog               cat                 dog   </span>
<span class="go">first        bar       baz       bar     baz       bar       baz       bar   </span>
<span class="go">second                                                                       </span>
<span class="go">one    -0.370647  0.357021 -1.157892 -0.6746 -1.344312 -1.776904  0.844885   </span>
<span class="go">two     1.075770       NaN -0.109050     NaN  1.643563       NaN -1.469388   </span>
<span class="go">exp               </span>
<span class="go">animal            </span>
<span class="go">first        baz  </span>
<span class="go">second            </span>
<span class="go">one    -0.968914  </span>
<span class="go">two          NaN  </span>

<span class="gp">In [1570]: </span><span class="n">df2</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="go">exp            A                   B                                       A  \</span>
<span class="go">animal       cat                 dog                 cat                 dog   </span>
<span class="go">second       one       two       one       two       one       two       one   </span>
<span class="go">first                                                                          </span>
<span class="go">bar    -0.370647  1.075770 -1.157892 -0.109050 -1.344312  1.643563  0.844885   </span>
<span class="go">baz     0.357021       NaN -0.674600       NaN -1.776904       NaN -0.968914   </span>
<span class="go">foo    -0.013960  0.895717 -0.362543  0.805244 -0.006154 -1.206412 -0.923061   </span>
<span class="go">qux          NaN  0.410835       NaN  0.813850       NaN  0.132003       NaN   </span>
<span class="go">exp               </span>
<span class="go">animal            </span>
<span class="go">second       two  </span>
<span class="go">first             </span>
<span class="go">bar    -1.469388  </span>
<span class="go">baz          NaN  </span>
<span class="go">foo     2.565646  </span>
<span class="go">qux    -0.827317  </span>
</pre></div>
</div>
</div>
<div class="section" id="reshaping-by-melt">
<span id="reshaping-melt"></span><h2>Reshaping by Melt<a class="headerlink" href="#reshaping-by-melt" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">melt</span></tt> function found in <tt class="docutils literal"><span class="pre">pandas.core.reshape</span></tt> is useful to massage a
DataFrame into a format where one or more columns are identifier variables,
while all other columns, considered measured variables, are &#8220;pivoted&#8221; to the
row axis, leaving just two non-identifier columns, &#8220;variable&#8221; and &#8220;value&#8221;. The
names of those columns can be customized by supplying the <tt class="docutils literal"><span class="pre">var_name</span></tt> and
<tt class="docutils literal"><span class="pre">value_name</span></tt> parameters.</p>
<p>For instance,</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1571]: </span><span class="n">cheese</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">({</span><span class="s">&#39;first&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s">&#39;John&#39;</span><span class="p">,</span> <span class="s">&#39;Mary&#39;</span><span class="p">],</span>
<span class="gp">   ......:</span>                     <span class="s">&#39;last&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s">&#39;Doe&#39;</span><span class="p">,</span> <span class="s">&#39;Bo&#39;</span><span class="p">],</span>
<span class="gp">   ......:</span>                     <span class="s">&#39;height&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="mf">5.5</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">],</span>
<span class="gp">   ......:</span>                     <span class="s">&#39;weight&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">130</span><span class="p">,</span> <span class="mi">150</span><span class="p">]})</span>
<span class="gp">   ......:</span> 

<span class="gp">In [1572]: </span><span class="n">cheese</span>

<span class="go">  first  height last  weight</span>
<span class="go">0  John     5.5  Doe     130</span>
<span class="go">1  Mary     6.0   Bo     150</span>

<span class="gp">In [1573]: </span><span class="n">melt</span><span class="p">(</span><span class="n">cheese</span><span class="p">,</span> <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;first&#39;</span><span class="p">,</span> <span class="s">&#39;last&#39;</span><span class="p">])</span>

<span class="go">  first last variable  value</span>
<span class="go">0  John  Doe   height    5.5</span>
<span class="go">1  Mary   Bo   height    6.0</span>
<span class="go">2  John  Doe   weight  130.0</span>
<span class="go">3  Mary   Bo   weight  150.0</span>

<span class="gp">In [1574]: </span><span class="n">melt</span><span class="p">(</span><span class="n">cheese</span><span class="p">,</span> <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;first&#39;</span><span class="p">,</span> <span class="s">&#39;last&#39;</span><span class="p">],</span> <span class="n">var_name</span><span class="o">=</span><span class="s">&#39;quantity&#39;</span><span class="p">)</span>

<span class="go">  first last quantity  value</span>
<span class="go">0  John  Doe   height    5.5</span>
<span class="go">1  Mary   Bo   height    6.0</span>
<span class="go">2  John  Doe   weight  130.0</span>
<span class="go">3  Mary   Bo   weight  150.0</span>
</pre></div>
</div>
</div>
<div class="section" id="combining-with-stats-and-groupby">
<h2>Combining with stats and GroupBy<a class="headerlink" href="#combining-with-stats-and-groupby" title="Permalink to this headline">¶</a></h2>
<p>It should be no shock that combining <tt class="docutils literal"><span class="pre">pivot</span></tt> / <tt class="docutils literal"><span class="pre">stack</span></tt> / <tt class="docutils literal"><span class="pre">unstack</span></tt> with
GroupBy and the basic Series and DataFrame statistical functions can produce
some very expressive and fast data manipulations.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1575]: </span><span class="n">df</span>

<span class="go">exp                  A         B                   A</span>
<span class="go">animal             cat       dog       cat       dog</span>
<span class="go">first second                                        </span>
<span class="go">bar   one    -0.370647 -1.157892 -1.344312  0.844885</span>
<span class="go">      two     1.075770 -0.109050  1.643563 -1.469388</span>
<span class="go">baz   one     0.357021 -0.674600 -1.776904 -0.968914</span>
<span class="go">      two    -1.294524  0.413738  0.276662 -0.472035</span>
<span class="go">foo   one    -0.013960 -0.362543 -0.006154 -0.923061</span>
<span class="go">      two     0.895717  0.805244 -1.206412  2.565646</span>
<span class="go">qux   one     1.431256  1.340309 -1.170299 -0.226169</span>
<span class="go">      two     0.410835  0.813850  0.132003 -0.827317</span>

<span class="gp">In [1576]: </span><span class="n">df</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>

<span class="go">animal             cat       dog</span>
<span class="go">first second                    </span>
<span class="go">bar   one    -0.857479 -0.156504</span>
<span class="go">      two     1.359666 -0.789219</span>
<span class="go">baz   one    -0.709942 -0.821757</span>
<span class="go">      two    -0.508931 -0.029148</span>
<span class="go">foo   one    -0.010057 -0.642802</span>
<span class="go">      two    -0.155347  1.685445</span>
<span class="go">qux   one     0.130479  0.557070</span>
<span class="go">      two     0.271419 -0.006733</span>

<span class="c"># same result, another way</span>
<span class="gp">In [1577]: </span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="go">animal             cat       dog</span>
<span class="go">first second                    </span>
<span class="go">bar   one    -0.857479 -0.156504</span>
<span class="go">      two     1.359666 -0.789219</span>
<span class="go">baz   one    -0.709942 -0.821757</span>
<span class="go">      two    -0.508931 -0.029148</span>
<span class="go">foo   one    -0.010057 -0.642802</span>
<span class="go">      two    -0.155347  1.685445</span>
<span class="go">qux   one     0.130479  0.557070</span>
<span class="go">      two     0.271419 -0.006733</span>

<span class="gp">In [1578]: </span><span class="n">df</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="go">exp            A         B</span>
<span class="go">second                    </span>
<span class="go">one     0.016301 -0.644049</span>
<span class="go">two     0.110588  0.346200</span>

<span class="gp">In [1579]: </span><span class="n">df</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="go">exp            A         B</span>
<span class="go">animal                    </span>
<span class="go">cat     0.311433 -0.431481</span>
<span class="go">dog    -0.184544  0.133632</span>
</pre></div>
</div>
</div>
<div class="section" id="pivot-tables-and-cross-tabulations">
<h2>Pivot tables and cross-tabulations<a class="headerlink" href="#pivot-tables-and-cross-tabulations" title="Permalink to this headline">¶</a></h2>
<p id="reshaping-pivot">The function <tt class="docutils literal"><span class="pre">pandas.pivot_table</span></tt> can be used to create spreadsheet-style pivot
tables. See the <a class="reference internal" href="cookbook.html#cookbook-pivot"><em>cookbook</em></a> for some advanced strategies</p>
<p>It takes a number of arguments</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">data</span></tt>: A DataFrame object</li>
<li><tt class="docutils literal"><span class="pre">values</span></tt>: a column or a list of columns to aggregate</li>
<li><tt class="docutils literal"><span class="pre">rows</span></tt>: list of columns to group by on the table rows</li>
<li><tt class="docutils literal"><span class="pre">cols</span></tt>: list of columns to group by on the table columns</li>
<li><tt class="docutils literal"><span class="pre">aggfunc</span></tt>: function to use for aggregation, defaulting to <tt class="docutils literal"><span class="pre">numpy.mean</span></tt></li>
</ul>
<p>Consider a data set like this:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1580]: </span><span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">({</span><span class="s">&#39;A&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s">&#39;one&#39;</span><span class="p">,</span> <span class="s">&#39;one&#39;</span><span class="p">,</span> <span class="s">&#39;two&#39;</span><span class="p">,</span> <span class="s">&#39;three&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span><span class="p">,</span>
<span class="gp">   ......:</span>                 <span class="s">&#39;B&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;B&#39;</span><span class="p">,</span> <span class="s">&#39;C&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">8</span><span class="p">,</span>
<span class="gp">   ......:</span>                 <span class="s">&#39;C&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span>
<span class="gp">   ......:</span>                 <span class="s">&#39;D&#39;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">24</span><span class="p">),</span>
<span class="gp">   ......:</span>                 <span class="s">&#39;E&#39;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">24</span><span class="p">)})</span>
<span class="gp">   ......:</span> 

<span class="gp">In [1581]: </span><span class="n">df</span>

<span class="go">        A  B    C         D         E</span>
<span class="go">0     one  A  foo -0.076467  0.959726</span>
<span class="go">1     one  B  foo -1.187678 -1.110336</span>
<span class="go">2     two  C  foo  1.130127 -0.619976</span>
<span class="go">3   three  A  bar -1.436737  0.149748</span>
<span class="go">4     one  B  bar -1.413681 -0.732339</span>
<span class="go">5     one  C  bar  1.607920  0.687738</span>
<span class="go">6     two  A  foo  1.024180  0.176444</span>
<span class="go">7   three  B  foo  0.569605  0.403310</span>
<span class="go">8     one  C  foo  0.875906 -0.154951</span>
<span class="go">9     one  A  bar -2.211372  0.301624</span>
<span class="go">10    two  B  bar  0.974466 -2.179861</span>
<span class="go">11  three  C  bar -2.006747 -1.369849</span>
<span class="go">12    one  A  foo -0.410001 -0.954208</span>
<span class="go">13    one  B  foo -0.078638  1.462696</span>
<span class="go">14    two  C  foo  0.545952 -1.743161</span>
<span class="go">15  three  A  bar -1.219217 -0.826591</span>
<span class="go">16    one  B  bar -1.226825 -0.345352</span>
<span class="go">17    one  C  bar  0.769804  1.314232</span>
<span class="go">18    two  A  foo -1.281247  0.690579</span>
<span class="go">19  three  B  foo -0.727707  0.995761</span>
<span class="go">20    one  C  foo -0.121306  2.396780</span>
<span class="go">21    one  A  bar -0.097883  0.014871</span>
<span class="go">22    two  B  bar  0.695775  3.357427</span>
<span class="go">23  three  C  bar  0.341734 -0.317441</span>
</pre></div>
</div>
<p>We can produce pivot tables from this data very easily:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1582]: </span><span class="n">pivot_table</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s">&#39;D&#39;</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;B&#39;</span><span class="p">],</span> <span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;C&#39;</span><span class="p">])</span>

<span class="go">C             bar       foo</span>
<span class="go">A     B                    </span>
<span class="go">one   A -1.154627 -0.243234</span>
<span class="go">      B -1.320253 -0.633158</span>
<span class="go">      C  1.188862  0.377300</span>
<span class="go">three A -1.327977       NaN</span>
<span class="go">      B       NaN -0.079051</span>
<span class="go">      C -0.832506       NaN</span>
<span class="go">two   A       NaN -0.128534</span>
<span class="go">      B  0.835120       NaN</span>
<span class="go">      C       NaN  0.838040</span>

<span class="gp">In [1583]: </span><span class="n">pivot_table</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s">&#39;D&#39;</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;B&#39;</span><span class="p">],</span> <span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;C&#39;</span><span class="p">],</span> <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">)</span>

<span class="go">A       one               three                 two          </span>
<span class="go">C       bar       foo       bar       foo       bar       foo</span>
<span class="go">B                                                            </span>
<span class="go">A -2.309255 -0.486468 -2.655954       NaN       NaN -0.257067</span>
<span class="go">B -2.640506 -1.266315       NaN -0.158102  1.670241       NaN</span>
<span class="go">C  2.377724  0.754600 -1.665013       NaN       NaN  1.676079</span>

<span class="gp">In [1584]: </span><span class="n">pivot_table</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;D&#39;</span><span class="p">,</span><span class="s">&#39;E&#39;</span><span class="p">],</span> <span class="n">rows</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;B&#39;</span><span class="p">],</span> <span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;C&#39;</span><span class="p">],</span> <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">)</span>

<span class="go">          D                                                           E  \</span>
<span class="go">A       one               three                 two                 one   </span>
<span class="go">C       bar       foo       bar       foo       bar       foo       bar   </span>
<span class="go">B                                                                         </span>
<span class="go">A -2.309255 -0.486468 -2.655954       NaN       NaN -0.257067  0.316495   </span>
<span class="go">B -2.640506 -1.266315       NaN -0.158102  1.670241       NaN -1.077692   </span>
<span class="go">C  2.377724  0.754600 -1.665013       NaN       NaN  1.676079  2.001971   </span>
<span class="go">                                                    </span>
<span class="go">A               three                two            </span>
<span class="go">C       foo       bar      foo       bar       foo  </span>
<span class="go">B                                                   </span>
<span class="go">A  0.005518 -0.676843      NaN       NaN  0.867024  </span>
<span class="go">B  0.352360       NaN  1.39907  1.177566       NaN  </span>
<span class="go">C  2.241830 -1.687290      NaN       NaN -2.363137  </span>
</pre></div>
</div>
<p>The result object is a DataFrame having potentially hierarchical indexes on the
rows and columns. If the <tt class="docutils literal"><span class="pre">values</span></tt> column name is not given, the pivot table
will include all of the data that can be aggregated in an additional level of
hierarchy in the columns:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1585]: </span><span class="n">pivot_table</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;B&#39;</span><span class="p">],</span> <span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;C&#39;</span><span class="p">])</span>

<span class="go">                D                   E          </span>
<span class="go">C             bar       foo       bar       foo</span>
<span class="go">A     B                                        </span>
<span class="go">one   A -1.154627 -0.243234  0.158248  0.002759</span>
<span class="go">      B -1.320253 -0.633158 -0.538846  0.176180</span>
<span class="go">      C  1.188862  0.377300  1.000985  1.120915</span>
<span class="go">three A -1.327977       NaN -0.338421       NaN</span>
<span class="go">      B       NaN -0.079051       NaN  0.699535</span>
<span class="go">      C -0.832506       NaN -0.843645       NaN</span>
<span class="go">two   A       NaN -0.128534       NaN  0.433512</span>
<span class="go">      B  0.835120       NaN  0.588783       NaN</span>
<span class="go">      C       NaN  0.838040       NaN -1.181568</span>
</pre></div>
</div>
<p>You can render a nice output of the table omitting the missing values by
calling <tt class="docutils literal"><span class="pre">to_string</span></tt> if you wish:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1586]: </span><span class="n">table</span> <span class="o">=</span> <span class="n">pivot_table</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;B&#39;</span><span class="p">],</span> <span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;C&#39;</span><span class="p">])</span>

<span class="gp">In [1587]: </span><span class="k">print</span> <span class="n">table</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">na_rep</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
<span class="go">                D                   E          </span>
<span class="go">C             bar       foo       bar       foo</span>
<span class="go">A     B                                        </span>
<span class="go">one   A -1.154627 -0.243234  0.158248  0.002759</span>
<span class="go">      B -1.320253 -0.633158 -0.538846  0.176180</span>
<span class="go">      C  1.188862  0.377300  1.000985  1.120915</span>
<span class="go">three A -1.327977           -0.338421          </span>
<span class="go">      B           -0.079051            0.699535</span>
<span class="go">      C -0.832506           -0.843645          </span>
<span class="go">two   A           -0.128534            0.433512</span>
<span class="go">      B  0.835120            0.588783          </span>
<span class="go">      C            0.838040           -1.181568</span>
</pre></div>
</div>
<p>Note that <tt class="docutils literal"><span class="pre">pivot_table</span></tt> is also available as an instance method on DataFrame.</p>
<div class="section" id="cross-tabulations">
<h3>Cross tabulations<a class="headerlink" href="#cross-tabulations" title="Permalink to this headline">¶</a></h3>
<p>Use the <tt class="docutils literal"><span class="pre">crosstab</span></tt> function to compute a cross-tabulation of two (or more)
factors. By default <tt class="docutils literal"><span class="pre">crosstab</span></tt> computes a frequency table of the factors
unless an array of values and an aggregation function are passed.</p>
<p>It takes a number of arguments</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">rows</span></tt>: array-like, values to group by in the rows</li>
<li><tt class="docutils literal"><span class="pre">cols</span></tt>: array-like, values to group by in the columns</li>
<li><tt class="docutils literal"><span class="pre">values</span></tt>: array-like, optional, array of values to aggregate according to
the factors</li>
<li><tt class="docutils literal"><span class="pre">aggfunc</span></tt>: function, optional, If no values array is passed, computes a
frequency table</li>
<li><tt class="docutils literal"><span class="pre">rownames</span></tt>: sequence, default None, must match number of row arrays passed</li>
<li><tt class="docutils literal"><span class="pre">colnames</span></tt>: sequence, default None, if passed, must match number of column
arrays passed</li>
<li><tt class="docutils literal"><span class="pre">margins</span></tt>: boolean, default False, Add row/column margins (subtotals)</li>
</ul>
<p>Any Series passed will have their name attributes used unless row or column
names for the cross-tabulation are specified</p>
<p>For example:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1588]: </span><span class="n">foo</span><span class="p">,</span> <span class="n">bar</span><span class="p">,</span> <span class="n">dull</span><span class="p">,</span> <span class="n">shiny</span><span class="p">,</span> <span class="n">one</span><span class="p">,</span> <span class="n">two</span> <span class="o">=</span> <span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">,</span> <span class="s">&#39;dull&#39;</span><span class="p">,</span> <span class="s">&#39;shiny&#39;</span><span class="p">,</span> <span class="s">&#39;one&#39;</span><span class="p">,</span> <span class="s">&#39;two&#39;</span>

<span class="gp">In [1589]: </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">foo</span><span class="p">,</span> <span class="n">foo</span><span class="p">,</span> <span class="n">bar</span><span class="p">,</span> <span class="n">bar</span><span class="p">,</span> <span class="n">foo</span><span class="p">,</span> <span class="n">foo</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>

<span class="gp">In [1590]: </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">one</span><span class="p">,</span> <span class="n">one</span><span class="p">,</span> <span class="n">two</span><span class="p">,</span> <span class="n">one</span><span class="p">,</span> <span class="n">two</span><span class="p">,</span> <span class="n">one</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>

<span class="gp">In [1591]: </span><span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dull</span><span class="p">,</span> <span class="n">dull</span><span class="p">,</span> <span class="n">shiny</span><span class="p">,</span> <span class="n">dull</span><span class="p">,</span> <span class="n">dull</span><span class="p">,</span> <span class="n">shiny</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>

<span class="gp">In [1592]: </span><span class="n">crosstab</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">[</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">],</span> <span class="n">rownames</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">],</span> <span class="n">colnames</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">])</span>

<span class="go">b     one          two       </span>
<span class="go">c    dull  shiny  dull  shiny</span>
<span class="go">a                            </span>
<span class="go">bar     1      0     0      1</span>
<span class="go">foo     2      1     1      0</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-margins-partial-aggregates">
<span id="reshaping-pivot-margins"></span><h3>Adding margins (partial aggregates)<a class="headerlink" href="#adding-margins-partial-aggregates" title="Permalink to this headline">¶</a></h3>
<p>If you pass <tt class="docutils literal"><span class="pre">margins=True</span></tt> to <tt class="docutils literal"><span class="pre">pivot_table</span></tt>, special <tt class="docutils literal"><span class="pre">All</span></tt> columns and
rows will be added with partial group aggregates across the categories on the
rows and columns:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1593]: </span><span class="n">df</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;B&#39;</span><span class="p">],</span> <span class="n">cols</span><span class="o">=</span><span class="s">&#39;C&#39;</span><span class="p">,</span> <span class="n">margins</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">)</span>

<span class="go">                D                             E                    </span>
<span class="go">C             bar       foo       All       bar       foo       All</span>
<span class="go">A     B                                                            </span>
<span class="go">one   A  1.494463  0.235844  1.019752  0.202765  1.353355  0.795165</span>
<span class="go">      B  0.132127  0.784210  0.606779  0.273641  1.819408  1.139647</span>
<span class="go">      C  0.592638  0.705136  0.708771  0.442998  1.804346  1.074910</span>
<span class="go">three A  0.153810       NaN  0.153810  0.690376       NaN  0.690376</span>
<span class="go">      B       NaN  0.917338  0.917338       NaN  0.418926  0.418926</span>
<span class="go">      C  1.660627       NaN  1.660627  0.744165       NaN  0.744165</span>
<span class="go">two   A       NaN  1.630183  1.630183       NaN  0.363548  0.363548</span>
<span class="go">      B  0.197065       NaN  0.197065  3.915454       NaN  3.915454</span>
<span class="go">      C       NaN  0.413074  0.413074       NaN  0.794212  0.794212</span>
<span class="go">All      1.294620  0.824989  1.064129  1.403041  1.188419  1.248988</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="tiling">
<span id="reshaping-tile"></span><h2>Tiling<a class="headerlink" href="#tiling" title="Permalink to this headline">¶</a></h2>
<p id="reshaping-tile-cut">The <tt class="docutils literal"><span class="pre">cut</span></tt> function computes groupings for the values of the input array and
is often used to transform continuous variables to discrete or categorical
variables:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1594]: </span><span class="n">ages</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">60</span><span class="p">])</span>

<span class="gp">In [1595]: </span><span class="n">cut</span><span class="p">(</span><span class="n">ages</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="go">Categorical: </span>
<span class="go">array([&#39;(9.95, 26.667]&#39;, &#39;(9.95, 26.667]&#39;, &#39;(9.95, 26.667]&#39;,</span>
<span class="go">       &#39;(9.95, 26.667]&#39;, &#39;(9.95, 26.667]&#39;, &#39;(9.95, 26.667]&#39;,</span>
<span class="go">       &#39;(26.667, 43.333]&#39;, &#39;(43.333, 60]&#39;, &#39;(43.333, 60]&#39;], dtype=object)</span>
<span class="go">Levels (3): Index([&#39;(9.95, 26.667]&#39;, &#39;(26.667, 43.333]&#39;, &#39;(43.333, 60]&#39;], dtype=object)</span>
</pre></div>
</div>
<p>If the <tt class="docutils literal"><span class="pre">bins</span></tt> keyword is an integer, then equal-width bins are formed.
Alternatively we can specify custom bin-edges:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1596]: </span><span class="n">cut</span><span class="p">(</span><span class="n">ages</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">70</span><span class="p">])</span>

<span class="go">Categorical: </span>
<span class="go">array([&#39;(0, 18]&#39;, &#39;(0, 18]&#39;, &#39;(0, 18]&#39;, &#39;(0, 18]&#39;, &#39;(18, 35]&#39;, &#39;(18, 35]&#39;,</span>
<span class="go">       &#39;(18, 35]&#39;, &#39;(35, 70]&#39;, &#39;(35, 70]&#39;], dtype=object)</span>
<span class="go">Levels (3): Index([&#39;(0, 18]&#39;, &#39;(18, 35]&#39;, &#39;(35, 70]&#39;], dtype=object)</span>
</pre></div>
</div>
</div>
</div>


                    </div>
                </div>
            </div>

            
            <div class="clearer"></div>
        </div>
    </div>
</div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="timeseries.html" title="Time Series / Date functionality"
             >next</a> |</li>
        <li class="right" >
          <a href="merging.html" title="Merge, join, and concatenate"
             >previous</a> |</li>
        <li><a href="index.html">pandas 0.11.1.dev-36c1263 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2008-2012, the pandas development team.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>